% \setcounter{section}{1}
\section{Biểu đồ tuần tự}
\label{sec:sequence}

\subsection{Chatbot}
\label{sec:sequence_chatbot}
Supervisor trực tiếp nhận câu hỏi từ chatbot system, phân tích (áp dụng
Chain of Thinking). Khi nhận được câu hỏi, hệ thống gửi cho Supervisor, 
Supervisor sẽ quyết định đây có yêu cầu query database
hay không. Nếu có, định tuyến tới Querier, ngược lại tới Researcher (search agent).

Querier làm các bước sau:
\begin{itemize}
    \item Sinh câu lệnh SQL, yêu cầu Verifier xác nhận (1)
    \item Nếu không có lỗi, gửi câu lệnh SQL tới database, nếu có lỗi
    lặp lại từ (1) (2)
    \item Nhận kết quả từ database (3)
    \item Yêu cầu Evaluator đánh giá kết quả (4)
    \item Nhận kết quả đánh giá từ Evaluator, đạt gửi tới Supervisor,
    nếu không lặp lại từ bước (1) (5)
\end{itemize}

Researcher làm các bước sau:
\begin{itemize}
    \item Nhận câu hỏi từ Supervisor (1)
    \item Gọi Tavily để tìm kiếm thông tin (2)
    \item Nhận kết quả từ Tavily (3)
    \item Reformat và gửi trả lại cho Supervisor (4)
\end{itemize}
Sau đó, Supervisor sẽ tổng hợp kết quả,
đưa ra câu trả lời cho người dùng. 
Hình trang tiếp theo mô tả quá trình này.
\newpage
\begin{figure}[H]
  \centering
  \includegraphics[width=1\textwidth]{figures/chatbot.png}
  \caption{Biểu đồ tuần tự cho chatbot}
\end{figure}

\subsection{Đăng ký}
\begin{itemize}
	\item Người dùng nhấn "Sign up for free", giao diện hiển thị form đăng ký.
	\item Gửi thông tin đăng ký tới Controller, kiểm tra định dạng và tính hợp lệ của dữ liệu.
	\item Nếu thông tin hợp lệ, gửi thông tin cho Service kiểm tra email đã tồn tại chưa, nếu không hiển thị thông báo lỗi.
	\item Nếu email chưa tồn tại, gửi thông tin qua Repo, lưu vào CSDl, nếu không hiển thị thông báo lỗi.
	\item Chuyển đến giao diện đăng nhập.
\end{itemize}
\newpage
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{figures/sequence-register.png}
	\caption{Biểu đồ tuần tự cho chức năng đăng ký}
\end{figure}

\subsection{Đăng nhập}
\begin{itemize}
	\item Người dùng nhấn "Login" và nhập email và mật khẩu hoặc nhấn "Login with Google".
	\item Gửi thông tin đăng nhập tới Controller, kiểm tra định dạng.
	\item Nếu thông tin hợp lệ, gửi cho Service kiểm tra email đã tồn tại trong CSDl chưa, nếu không thông báo lỗi.
	\item Nếu email tồn tại, kiểm tra thông tin mật khẩu.
	\item Nếu mật khẩu đúng, thông báo thành công, giao diện chuyển sang home, nếu không thông báo lỗi.
\end{itemize}
\newpage
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{figures/sequence-login.png}
	\caption{Biểu đồ tuần tự cho chức năng đăng nhập}
	\end{figure}

\subsection{Thêm giao dịch mới}
\begin{itemize}
	\item Người dùng thêm giao dịch: nhấn nút ``Thêm giao dịch'' trên web, Điền thông tin (số tiền, danh mục, ghi chú...).
	\item Hệ thống xử lý: Kiểm tra dữ liệu, nếu dữ liệu hợp lệ lưu vào database.
	\item Hệ thống hiển thị kết quả.
\end{itemize}
\newpage
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{figures/add-transac-sq.png}
	\caption{Biểu đồ tuần tự cho chức năng thêm giao dịch mới}
\end{figure}
